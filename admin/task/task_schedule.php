<?php
 define('IN_DAEM', true); include '../includes/init.php'; $userAry = get_user_realname(); $status = !empty($_GET['status']) ? $_GET['status'] : ''; $type = !empty($_GET['type']) ? $_GET['type'] : ''; $builder = !empty($_GET['builder']) ? $_GET['builder'] : ''; $performer = !empty($_GET['performer']) ? $_GET['performer'] : ''; $statDate = !empty($_GET['statDate']) ? $_GET['statDate'] : date('Y-m-d'); $cond = ''; if (!empty($status)) { $cond .= " and status = '".$status."'"; } if (!empty($type)) { $cond .= " and type = '".$type."'"; } if (!empty($builder)) { $cond .= " and builder = '".$builder."'"; } if (!empty($performer)) { $cond .= " and performer = '".$performer."'"; } $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."task_job where 1 = 1".$cond; $dataAry = array(); $i = 0; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $dataAry[$i]['text'] = $row['title']; $dataAry[$i]['status'] = $jobStatus[$row['status']]; $dataAry[$i]['builder'] = $userAry[$row['builder']]; $dataAry[$i]['performer'] = $userAry[$row['performer']]; $dataAry[$i]['start_date'] = $row['start_time']; $dataAry[$i]['end_date'] = $row['end_time']; $dataAry[$i]['details'] = $row['content']; $i++; } $data = json_encode($dataAry); include template();