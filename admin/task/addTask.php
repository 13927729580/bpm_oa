<?php
 define('IN_DAEM', true); include '../includes/init.php'; include '../templateManage/templateConfig.php'; $type = empty($_GET["type"]) ? "outer" : $_GET["type"]; if($type == "inner") { include '../templateManage/templateConfigInner.php'; } $userAry = get_user_realname(); $userAllowAry = get_user_realname('0'); if(!empty($_POST)) { $outboard = $_POST["outboard"]; $projectId = $_POST["projectId"]; $productCodeId = $_POST["productCodeId"]; $innerProductCodeId = $_POST["innerProductCodeId"]; $innerProductModel = $_POST["innerProductModel"]; $innerProductCatalog = $_POST["innerProductCatalog"]; $innerPrintedType = $_POST["innerPrintedType"]; $outerProductCodeId = $_POST["outerProductCodeId"]; $outerProductModel = $_POST["outerProductModel"]; $outerProductCatalog = $_POST["outerProductCatalog"]; $outerPrintedType = $_POST["outerPrintedType"]; $certificationType = $_POST["certificationType"]; $approveType = $_POST["approveType"]; $basicProductCode = $_POST["basicProductCode"]; $eer = $_POST["eer"]; $panelColor = $_POST["panelColor"]; $panelInnerColor = $_POST["panelInnerColor"]; $approver = $_POST["approver"]; $paramIntoDatabaseStr = $_POST["paramIntoDatabaseStr"]; $checkboxParamString = $_POST["checkboxParamString"]; $checkboxValueString = $_POST["checkboxValueString"]; $checkboxParamAry = explode(",",$checkboxParamString); $checkboxValueAry = explode(",",$checkboxValueString); $TemplateIdString = $_POST["TemplateIdString"]; $TemplateIdAry = explode(",",$TemplateIdString); $coolType = $_POST["coolType"]; $messageReturn = "<script language=\"javascript\">alert(\"测试测试：输出警告窗口，请返回检查!\")</script>"; $fileBasicPath = file_upload(DAEM_DATA_ROOT."upload"); $filePath = DAEM_PATH."data/upload/".basename($fileBasicPath); if(empty($fileBasicPath)) { $filePath = '-'; } $fileBasicPath2 = file_upload_param(DAEM_DATA_ROOT."upload","file2"); $filePath2 = DAEM_PATH."data/upload/".basename($fileBasicPath2); if(empty($fileBasicPath2)) { $filePath2 = '-'; } for ($k = 0; $k < count($checkboxParamAry); $k++) { checkEncodingMaterial($checkboxValueAry[$k]); } for ($k = 0; $k < count($checkboxParamAry); $k++) { $templateId = ""; if (stristr($checkboxParamAry[$k],"Inner") || stristr($checkboxParamAry[$k],"Param")) { $innerPrintedType = $checkboxParamAry[$k]; $innerProductCodeId = $checkboxValueAry[$k]; $innerProductModel = $_POST["innerProductModel"]; $innerProductCatalog = $_POST["innerProductCatalog"]; $templateId = $TemplateIdAry[$k]; if (empty($templateId)) { $templateId = $_POST["outerTemplateId"]; } } else { $innerProductCodeId = "-"; $innerProductModel = "-"; $innerProductCatalog = "-"; $innerPrintedType = "-"; } if (stristr($checkboxParamAry[$k],"Outer")) { $outerPrintedType = $checkboxParamAry[$k]; $outerProductCodeId = $checkboxValueAry[$k];; $outerProductModel = $_POST["outerProductModel"]; $outerProductCatalog = $_POST["outerProductCatalog"]; $templateId = $TemplateIdAry[$k]; if (empty($templateId)) { $templateId = $_POST["innerTemplateId"]; } } else { $outerProductCodeId = "-"; $outerProductModel = "-"; $outerProductCatalog = "-"; $outerPrintedType = "-"; } $insertSql = "INSERT INTO [DRSDatabase].[dbo].[TaskEntity]
            ([outboard],[projectId],[productCodeId],[innerProductCodeId],[innerProductModel],[innerProductCatalog],[innerPrintedType],[outerProductCodeId],[outerProductModel],[outerProductCatalog],[outerPrintedType],[certificationType],[approveType],[basicProductCode],[eer],[templateId],[PDMParam],[encodingMaterial],[panelColor],[panelInnerColor],[approver],[filePath],[filePath2],[builder],[approverStatus],[createDateTime],[typeOf],[coolType]) VALUES
            ('".$outboard."','".$projectId."','".$productCodeId."','".$innerProductCodeId."','".$innerProductModel."','".$innerProductCatalog."','".$innerPrintedType."','".$outerProductCodeId."','".$outerProductModel."','".$outerProductCatalog."','".$outerPrintedType."','".$certificationType."', '".$approveType."','".$basicProductCode."', '".$eer."','".$templateId."', '".$paramIntoDatabaseStr."','".$checkboxValueAry[$k]."', '".$panelColor."','".$panelInnerColor."', '".$approver."','".$filePath."', '".$filePath2."', '".$_SESSION['UserName']."', '0', '".date('Y-m-d H:i:s',DAEM_TIME)."','".$type."','".$coolType."')"; $conn->query( $insertSql ); } gourl("添加成功", "taskList.php?type=".$type); } function checkEncodingMaterial($encodingMaterial) { global $conn; $sql = "SELECT TOP 1 * FROM [DRSDatabase].[dbo].[TaskEntity] WHERE [encodingMaterial] = '".$encodingMaterial."' AND [status] = '1'"; $stmt = $conn->query( $sql ); while ( $row = $stmt->fetch( PDO::FETCH_ASSOC )) { if($row["encodingMaterial"] > 0) gourl("已存在物料编码".$encodingMaterial."!请下发新版本", "",-1); } } include template();