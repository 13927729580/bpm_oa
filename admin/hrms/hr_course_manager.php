<?php
 define('IN_DAEM', true); include '../includes/init.php'; $userAry = get_user_realname('0'); $studentInfoAry = get_student_info('y'); $studentInfoNoLimitAry = get_student_info(); if (!empty($_GET['submit'])) { $cid = trim($_GET['cid']); $course_name = trim($_GET['course_name']); $teacher = $_GET['teacher']; $subject_type = $_GET['subject_type']; $grade = $_GET['grade']; $student = trim($_GET['student']); $cond = ''; if (!empty($cid)) { $cond .= " and cid = '".$cid."'"; } if (!empty($course_name)) { $cond .= " and course_name like '%".$course_name."%'"; } if (!empty($teacher)) { $cond .= " and teacher_account = '".$teacher."'"; } if (!empty($subject_type)) { $cond .= " and subject_type = '".$subject_type."'"; } if (!empty($grade)) { $cond .= " and grade = '".$grade."'"; } if (!empty($student)) { $sidStr = $cidStr = ''; $sql = "select sid from ".DB_DAEMDB.".".TB_SUFFIX."hr_student where name like '%".$student."%'"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $sidStr .= "'".$row['sid']."',"; } $sidStr = trim($sidStr,','); $sql = "select cid from ".DB_DAEMDB.".".TB_SUFFIX."hr_course_enroll where sid in (".$sidStr.")"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $cidStr .= "'".$row['cid']."',"; } $cidStr = trim($cidStr,','); $cond .= " and cid in (".$cidStr.")"; } } $courseStudentAry = array(); $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."hr_course_enroll order by status asc"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { if ($row['status'] == '1' && isset($studentInfoAry[$row['sid']])) { if (isset($courseStudentAry[$row['cid']])) { $courseStudentAry[$row['cid']] .= ",<a style=\"color:#ffffff;font-weight:bold;background:#51A101;\">".$studentInfoNoLimitAry[$row['sid']]."</a>"; } else { $courseStudentAry[$row['cid']] = "<a style=\"color:#ffffff;font-weight:bold;background:#51A101;\">".$studentInfoNoLimitAry[$row['sid']]."</a>"; } } else { if (isset($courseStudentAry[$row['cid']])) { $courseStudentAry[$row['cid']] .= ",<a style=\"color:#ffffff;font-weight:bold;background:#D95762;\">".$studentInfoNoLimitAry[$row['sid']]."</a>"; } else { $courseStudentAry[$row['cid']] .= "<a style=\"color:#ffffff;font-weight:bold;background:#D95762;\">".$studentInfoNoLimitAry[$row['sid']]."</a>"; } } } $dataAry = array(); $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."hr_course_info where 1=1 ".$cond." order by create_time desc"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $dataAry[$row['cid']] = $row; $dataAry[$row['cid']]['sid'] = isset($courseStudentAry[$row['cid']]) ? $courseStudentAry[$row['cid']] : ''; } include template(); 