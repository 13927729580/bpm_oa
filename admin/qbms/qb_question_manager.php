<?php
 define('IN_DAEM', true); include '../includes/init.php'; include DAEM_CONFIG_ROOT."cdnConfig.php"; $isOpenCdn = TRUE; $userAry = get_user_realname(); $userName = $_SESSION['UserName']; $editor = $userName; $proofStatus = '1'; $appStatus = '0'; if (!empty($_GET['submit'])) { $grade = $_GET['grade']; $subject_type = $_GET['subject_type']; $term = $_GET['term']; $chapter = $_GET['chapter']; $question_type = $_GET['question_type']; $last_editor = $_GET['last_editor']; $q_degree = $_GET['q_degree']; $proofStatus = $_GET['proofStatus']; $appStatus = $_GET['appStatus']; $q_index = $_GET['q_index']; } $cond = ''; if (!empty($grade)) { $cond .= " and grade = '".$grade."'"; } if (!empty($subject_type)) { $cond .= " and subject_type = '".$subject_type."'"; } if (!empty($term)) { $cond .= " and term = '".$term."'"; } if (!empty($chapter)) { $cond .= " and chapter = '".$chapter."'"; } if (!empty($question_type)) { $cond .= " and question_type = '".$question_type."'"; } if (!empty($last_editor)) { $cond .= " and last_editor = '".$last_editor."'"; } if (!empty($q_degree)) { $cond .= " and q_degree = '".$q_degree."'"; } if (!empty($proofStatus) || isset($proofStatus)) { $cond .= " and proof_status = '".$proofStatus."'"; } if (!empty($appStatus) || isset($appStatus)) { $cond .= " and app_status = '".$appStatus."'"; } if (!empty($q_index)) { $cond .= " and q_index like '%".$q_index."%'"; } $questionAry = array(); $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."qb_question_info where 1=1 ".$cond."
		order by create_time asc limit 100"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { if ($isOpenCdn) { $row['question_img_path'] = str_replace('../../data/upload/question_bank/qst_img_201406/math/', CDN_PATH, $row['question_img_path']); $row['a_option_img_path'] = str_replace('../../data/upload/question_bank/qst_img_201406/math/', CDN_PATH, $row['a_option_img_path']); $row['b_option_img_path'] = str_replace('../../data/upload/question_bank/qst_img_201406/math/', CDN_PATH, $row['b_option_img_path']); $row['c_option_img_path'] = str_replace('../../data/upload/question_bank/qst_img_201406/math/', CDN_PATH, $row['c_option_img_path']); $row['d_option_img_path'] = str_replace('../../data/upload/question_bank/qst_img_201406/math/', CDN_PATH, $row['d_option_img_path']); } $questionAry[] = $row; } $countAry = array(); $sql = "select subject_type,count(*) as count from ".DB_DAEMDB.".".TB_SUFFIX."qb_question_info group by subject_type"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $countAry[$row['subject_type']] = $row['count']; $totalNum += $row['count']; } $proofCountAry = array(); $sql = "select proof_status,count(*) as count from ".DB_DAEMDB.".".TB_SUFFIX."qb_question_info group by proof_status"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $proofCountAry[$row['proof_status']] = $row['count']; } $appCountAry = array(); $sql = "select app_status,count(*) as count from ".DB_DAEMDB.".".TB_SUFFIX."qb_question_info group by app_status"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $appCountAry[$row['app_status']] = $row['count']; } $teacherProofCountAry = array(); $sql = "select last_editor,count(*) as count from ".DB_DAEMDB.".".TB_SUFFIX."qb_question_info group by last_editor order by count desc"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $teacherProofCountAry[$userAry[$row['last_editor']]] = $row['count']; } include template(); 