<?php
 header("Content-Type:text/html;charset=utf-8"); error_reporting( E_ERROR | E_WARNING ); include "Uploader.class.php"; $config = array( "savePath" => "upload/" , "maxSize" => 1000 , "allowFiles" => array( ".gif" , ".png" , ".jpg" , ".jpeg" , ".bmp" ) ); $tmpPath = "tmp/"; $action = htmlspecialchars( $_GET[ "action" ] ); if ( $action == "tmpImg" ) { $config[ "savePath" ] = $tmpPath; $up = new Uploader( "upfile" , $config ); $info = $up->getFileInfo(); echo "<script>parent.ue_callback('" . $info[ "url" ] . "','" . $info[ "state" ] . "')</script>"; } else { $up = new Uploader( "content" , $config , true ); if(file_exists($tmpPath)){ delDir($tmpPath); } $info = $up->getFileInfo(); echo "{'url':'" . $info[ "url" ] . "',state:'" . $info[ "state" ] . "'}"; } function delDir( $dir ) { $dh = opendir( $dir ); while ( $file = readdir( $dh ) ) { if ( $file != "." && $file != ".." ) { $fullpath = $dir . "/" . $file; if ( !is_dir( $fullpath ) ) { unlink( $fullpath ); } else { delDir( $fullpath ); } } } closedir( $dh ); return rmdir( $dir ); } 