<?php  define('IN_DAEM', true); include '../includes/init.php'; $userAry = get_user_realname(); include '../includes/task.func.php'; $projectAllAry = get_project_info(); $projectInfo = get_project_detail(); $versionAry = array(); $sql = "select distinct version from ".DB_DAEMDB.".".TB_SUFFIX."task_job"; $query = $db->query($sql); $key = 1; while ($row = $db->fetch_array($query)) { $versionAry[$key] = $row['version']; $key ++; } $status = !empty($_GET['status'])? $_GET['status'] : '-1'; $type = !empty($_GET['type'])? $_GET['type'] : '-1'; $builder = !empty($_GET['builder'])? $_GET['builder'] : '-1'; $performer = !empty($_GET['performer'])? $_GET['performer'] : '-1'; $follower = !empty($_GET['follower'])? $_GET['follower'] : '-1'; $version = !empty($_GET['version'])? $_GET['version'] : '-1'; $jobStartDate = !empty($_GET['jobStartDate'])? $_GET['jobStartDate'] : ''; $jobEndDate = !empty($_GET['jobEndDate'])? $_GET['jobEndDate'] : ''; $startDate = !empty($_GET['startDate'])? $_GET['startDate'] : ''; $endDate = !empty($_GET['endDate'])? $_GET['endDate'] : ''; $createDate = !empty($_GET['createDate'])? $_GET['createDate'] : ''; $sAndSql = ''; if ($status>0){ $sAndSql .= " and status = '".$status."'"; } if ($type>0){ $sAndSql .= " and type = '".$type."'"; } if ($builder != '-1' ){ $sAndSql .= " and builder = '".$builder."'"; } if ($performer != '-1'){ $sAndSql .= " and performer = '".$performer."'"; } if ($follower != '-1' ){ $sAndSql .= " and follower = '".$follower."'"; } if ($version>0){ $sAndSql .= " and version = '".$versionAry[$version]."'"; } if (!empty($jobStartDate)){ $sAndSql .= " and unix_timestamp(start_time) >= '".strtotime($jobStartDate)."'"; } if (!empty($jobEndDate)){ $sAndSql .= " and unix_timestamp(end_time) <= '".strtotime($jobEndDate)."'"; } if (!empty($startDate)){ $sAndSql .= " and unix_timestamp(start_time) = '".strtotime(date('Ymd',strtotime($startDate)))."'"; } if (!empty($endDate)){ $sAndSql .= " and unix_timestamp(end_time) = '".strtotime(date('Ymd',strtotime($endDate)))."'"; } if (!empty($createDate)){ $sAndSql .= " and create_time = '".intval(date('Ymd',strtotime(createDate)))."'"; } $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."task_job where 1 = 1 ".$sAndSql." order by create_time desc"; $result = $db->query($sql); $dataAry = array(); while ($rows = $db->fetch_array($result)) { $dataAry[] = $rows; } $sSql = "select count(*) as total from ".DB_DAEMDB.".".TB_SUFFIX."task_job where 1=1 ".$sAndSql; $row = $db->query_first($sSql); $total = $row['total']; include template(); 