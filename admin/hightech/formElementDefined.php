<?php
 define('IN_DAEM', true); include '../includes/init.php'; require_once "./excelBIConfig.php"; require_once "../includes/class/pinyin.class.php"; $count = 0; $actName = "新增"; if(!empty($_POST)) { if(empty($_POST["name"]) || empty($_POST["formElementSign"])) gourl("缺少响应参数!","",-1); $formElementSign = $_POST["formElementSign"]; $sql = "select id from form_element_defined where form_element_sign = '".$formElementSign."'"; $result = $db->query_first($sql); $configDataAry = array(); $tmpAry = explode(',',$_POST["paramName"]); foreach($tmpAry as $key=>$val) { if($val == "undefined") continue; $tmpDepth2Ary = explode('=',$val); $tmpDepth2Ary[0] = trim($tmpDepth2Ary[0]); $tmpDepth2Ary[1] = trim($tmpDepth2Ary[1]); $configDataAry[$tmpDepth2Ary[1]] = $tmpDepth2Ary[0]; } $serializeConfigData = serialize($configDataAry); if($result["id"]>0) { $op = "修改"; $sql = "update form_element_defined
            set name = '".$_POST["name"]."',
            type = '".$_POST["elementType"]."',
            config_data = '".$serializeConfigData."',"; $sql .= "builder = '".$_SESSION["UserName"]."',"; $sql .= "status = '1',"; $sql .= "create_time = '".DAEM_TIME."' "; $sql .= "where form_element_sign = '".$formElementSign."'"; } else { $op = "添加"; $sql = "insert into form_element_defined
            set name = '".$_POST["name"]."',
            form_element_sign = '".$_POST["formElementSign"]."',
            type = '".$_POST["elementType"]."',
            config_data = '".$serializeConfigData."',"; $sql .= "builder = '".$_SESSION["UserName"]."',"; $sql .= "status = '1',"; $sql .= "create_time = '".DAEM_TIME."',"; $sql = rtrim($sql,","); } $res = $db->query($sql); if($res) { gourl($op."元素成功!","formElementDefined.php"); } else { gourl($op."失败!","",-1); } } if(!empty($_GET["form_element_sign"]) && $_GET["act"] == "del") { $sql = "delete from form_element_defined where form_element_sign = '". $_GET["form_element_sign"]."'"; $res = $db->query($sql); if($res) { gourl("删除元素成功!","formElementDefined.php"); } else { gourl("删除失败!","",-1); } } if(!empty($_GET["form_element_sign"])) { $actName = "修改"; $sql = "select * from form_element_defined where form_element_sign = '". $_GET["form_element_sign"]."'"; $result = $db->query_first($sql); $result["config_data"] = unserialize($result["config_data"]); $result["config_data_html"] = ""; $count = count($result["config_data"]); $i = 0; foreach($result["config_data"] as $key=>$val) { $result["config_data_html"] .= "<tr><td>"; if($i == 0) { $result["config_data_html"] .= "<br /><input id=\"param".$i."\" type=\"text\" class=\"dfinput\" name= \"param".$i."\" value = \"".$val."=".$key."\"> <input name=\"button\" class=\"btn-info\" type=\"button\" onclick=\"additem('formInfoId')\" value=\"添加\" />"; } else { $result["config_data_html"] .= "<br /><input id=\"param".$i."\" type=\"text\" class=\"dfinput\" name= \"param".$i."\" value = \"".$val."=".$key."\"> <input type = \"button\" class=\"btn-danger\" value= \"删除\" onclick = \"deleteitem(this);\" >"; } $result["config_data_html"] .= "</td></tr>"; $i++; } } $dataAry = array(); $sql = "select * from form_element_defined order by id DESC"; $query = $db->query($sql); while($row = $db->fetch_array($query)) { $row["config_data"] = unserialize($row["config_data"]); $dataAry[$row["id"]] = $row; } include template();