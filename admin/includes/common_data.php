<?php
 function get_user_realname($permit='') { global $db; $userAry = array(); $sql = "select a_account,a_username from ".DB_DAEMDB.".".TB_SUFFIX."db_adminuser where 1=1 "; if ($permit != '') { $sql .= " and a_ispermit = '".$permit."'"; } $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $userAry[$row['a_account']] = $row['a_username']; } return $userAry; } function check_user_group($user,$groupId) { global $db; $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."db_adminuser where a_account = '".$user."' limit 1"; $result = $db->query_first($sql); if ($result['a_gid'] == $groupId) { return TRUE; } else { return FALSE; } } function get_department_kv() { global $db; $departmentAry = array(); $sql = "select id,name from ".DB_DAEMDB.".".TB_SUFFIX."db_department"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $departmentAry[$row['id']] = $row['name']; } return $departmentAry; } function get_department_admin() { global $db; $departmentAdminAry = array(); $sql = "select id,leader from ".DB_DAEMDB.".".TB_SUFFIX."db_department"; $query = $db->query($sql); while ($row = $db->fetch_array($query)) { $tmpLeaderAry = explode(',',$row['leader']); foreach($tmpLeaderAry as $key=>$val) { $departmentAdminAry[$row['id']][$val] = 1; } } return $departmentAdminAry; } function check_user_ele_role($ele_role) { $departmentAdminAry = get_department_admin(); if(empty($ele_role) || strpos($ele_role,$_SESSION["UserName"])) { return 1; } else { $currentExecutorTmp = explode(',',$ele_role); foreach($currentExecutorTmp as $key=>$val) { $depthValAry = explode('_',$val); if($depthValAry[0] == 'department') { if($departmentAdminAry[$depthValAry[1]][$_SESSION["UserName"]] == 1) return 1; } } return 0; } }