<?php
 define('IN_DAEM', true); include_once '../includes/init.php'; include_once '../includes/system.func.php'; include_once '../includes/user.func.php'; $userAry = get_user_realname(); $departmentAry = get_department_kv(); $id = ceil($_GET['id']); if ($id > 0) { $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."db_department where id='".$id."'"; $result = $db->query_first($sql); } $department = ShowDepartment(); foreach($department as $key=>$val) { $tmpAry = explode(',',$val['leader']); $realNameStr = ''; foreach ($tmpAry as $kk=>$vv) { $realNameStr .= $userAry[$vv].','; } $department[$key]['leader'] = trim($realNameStr,','); } include template('system','department_list'); function ShowDepartment() { global $db; $array = array(); $sql = "select * from ".DB_DAEMDB.".".TB_SUFFIX."db_department"; $result = $db->query($sql); while ($rows = $db->fetch_array($result)) { $array['id'] = $rows['id']; $array['parent_id'] = $rows['parent_id']; $array['name'] = $rows['name']; $array['description'] = $rows['description']; $array['leader'] = $rows['leader']; $arrays[$array['id']] = $array; } return $arrays; } 