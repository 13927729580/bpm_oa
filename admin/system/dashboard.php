<?php
 define('IN_DAEM', true); include '../includes/init.php'; $weekStaticStr = ""; $thisWeekCount = ""; $sql = "SELECT COUNT(*) as totalNum,week(from_unixtime(create_time, '%Y-%m-%d')) as weekNum FROM case_management
        where create_time >= unix_timestamp(DATE_SUB(CURDATE(),INTERVAL dayofyear(now())-1 DAY))
        GROUP BY week(from_unixtime(create_time, '%Y-%m-%d')) order by weekNum asc limit 8"; $query = $db->query($sql); while($row = $db->fetch_array($query)) { $weekStaticStr .= $row["totalNum"].","; $thisWeekCount = $row["totalNum"]; } $weekStaticStr = trim($weekStaticStr,","); $monthStaticStr = ""; $thisMonthCount = ""; $sql = "SELECT COUNT(*) as totalNum,month(from_unixtime(create_time, '%Y-%m-%d')) as monthNum FROM case_management
        where create_time >= unix_timestamp(DATE_SUB(CURDATE(),INTERVAL dayofyear(now())-1 DAY))
        GROUP BY month(from_unixtime(create_time, '%Y-%m-%d')) order by monthNum asc limit 8"; $query = $db->query($sql); while($row = $db->fetch_array($query)) { $monthStaticStr .= $row["totalNum"].","; $thisMonthCount = $row["totalNum"]; } $monthStaticStr = trim($monthStaticStr,","); $nodeTypeAry = getAllNodeTypeDefine(); $totalCaseNum = $finishCaseNum = $runningCaseNum = 0; $sql = "select current_location from case_management"; $query = $db->query($sql); while($row = $db->fetch_array($query)) { $tmpAry = explode(';',$row["current_location"]); foreach($tmpAry as $key=>$val) { $totalCaseNum++; if($nodeTypeAry[$val] != "end round mix")break; $finishCaseNum++; } } $sql = "show tables like 't_%_data'"; $query = $db->query($sql); while($row = $db->fetch_array($query)) { } function getAllNodeTypeDefine() { global $db; $nodeTypeAry = array(); $sql = "select config_data from process_management"; $query = $db->query($sql); while($row = $db->fetch_array($query)) { $tmpConfigDataAry = json_decode($row["config_data"],true); foreach($tmpConfigDataAry["nodes"] as $key=>$val) { $nodeTypeAry[$key] = $val["type"]; } } return $nodeTypeAry; } include template();