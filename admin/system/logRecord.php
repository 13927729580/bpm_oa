<?php
 define('IN_DAEM', true); include_once '../includes/init.php'; $iPage = $db->Get('page',1); $iPageZize = $db->Get('iPageZize',20); $iOffset = ($iPage-1)*$iPageZize; $begin = !empty($_GET['begin'])? $_GET['begin'] : date("Y-m-d 00:00:00",strtotime("-2 days"));$end = !empty($_GET['end'])? $_GET['end'] : date("Y-m-d 23:59:59");$sUserName = !empty($_GET['sUserName'])? $_GET['sUserName'] : "";$sIP = !empty($_GET['sIP'])? $_GET['sIP'] : "";$sMenuName = !empty($_GET['sMenuName'])? $_GET['sMenuName'] : ""; $sAndSql = " and dRecordTime between '".$begin."' and '".$end."'"; if(!empty($sUserName)) { $sAndSql .= " and sUserName like '%".$sUserName."%'"; } if(!empty($sIP)) { $sAndSql .= " and sIP like '%".$sIP."%'"; } if(!empty($sMenuName)) { $sAndSql .= " and sMenuName like '%".$sMenuName."%'"; } $sSql = "select count(*) as iTotal from ".DB_DAEMDB.".".TB_SUFFIX."log_operation_record where 1=1 ".$sAndSql; $row = $db->query_first($sSql); $iTotal = $row['iTotal']; $sSql = "SELECT * FROM ".DB_DAEMDB.".".TB_SUFFIX."log_operation_record where 1=1 ".$sAndSql." order by dRecordTime desc"; $result = $db->query($sSql); $aData = array(); while ($rows = $db->fetch_array($result)) { $rows['iNum'] = ++$iOffset; $aData[] = $rows; } $sUrl = "?begin=$begin&end=$end&sUserName=$sUserName&sIP=$sIP&sMenuName=".urlencode($sMenuName)."&"; $pagehtml = showpage($iPage,$iPageZize,$iTotal,$sUrl); include template();