$(document).ready(function(){gebo_chat.init()});gebo_chat={init:function(){if(!is_touch_device())chatEditor=$("#chat_editor").cleditor({width:"100%",height:"120px",controls:"icon bold italic underline"})[0];$(".send_msg").click(function(a){gebo_chat.sendMsg();a.preventDefault()});gebo_chat.sendMsg_enter();gebo_chat.add_remove_user();gebo_chat.close()},close:function(){$(".chat_close").click(function(a){$(".msg_window .chat_msg").not(".msg_clone").remove();$(".chat_sidebar li.active").not(".chat_you").removeClass("active");$(".act_users").html("1");!is_touch_device()&&chatEditor.clear();a.preventDefault()})},sendMsg_enter:function(){var a;a=setInterval(function(){if(!is_touch_device()){if($(".cleditorMain").css("visibility")==="visible"){$(".cleditorMain iframe").contents().on("keyup","body",function(a){a.keyCode==13&&$(".enter_msg").hasClass("active")&&gebo_chat.sendMsg()});chatEditor.focus()}}else $("#chat_editor").on("keyup",function(a){if(a.keyCode==13&&$(".enter_msg").hasClass("active")){gebo_chat.sendMsg();$("#chat_editor").val("").text("")}});clearInterval(a)},2e3)},sendMsg:function(){!is_touch_device()&&chatEditor.updateTextArea();var d=$("#chat_editor").val(),c=$("#chat_user").val(),b=d.replace(/(^(<div><br><\/div>)+|(<div><br><\/div>)$)/g,"").replace(/(^(<br>)+|(<br>)+$)/g,"");if(b!=""){var a=$(".msg_clone").clone();$(".msg_window").append(a);a.find(".chat_msg_date").html(moment().format("HH:mm"));a.find(".chat_msg_body").html(b);a.find(".chat_user_name").html(c);a.removeClass("msg_clone").show();$(".msg_window").stop().animate({scrollTop:a.offset().top},2e3)}!is_touch_device()&&chatEditor.clear().focus()},add_remove_user:function(){$(".chat_sidebar li.online").not(".chat_you").find("a").on("click",function(a){if(!$(this).closest("li").hasClass("active"))$(this).closest("li").addClass("active");else $(this).closest("li").removeClass("active");$(".act_users").html($(".chat_sidebar li.active").length);a.preventDefault()})}}