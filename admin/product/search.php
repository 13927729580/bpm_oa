<?php
 define('IN_DAEM', true); include_once '../includes/init.php'; include_once './product.func.php'; $paramListAry = get_param_list(); $perPageNum = '200'; $paramInCheckAry = array(); foreach ($_GET as $key=>$val) { $tmpKey = str_replace(array('operator_','value_','_extra1'),'',$key); $tmpKey2 = str_replace('_'.$tmpKey,'',$key); $paramInCheckAry[$tmpKey][$tmpKey2] = $val; } $condAry = array(); foreach($paramInCheckAry as $key=>$val) { if(($val['operator'] == ''|| $val['operator'] == '0') && $val['value'] == '') continue; $noSpecial = $operatorAry; $val['operator'] = empty($val['operator']) ? '=' : $val['operator']; unset($noSpecial['between']);unset($noSpecial['like']); if( in_array($val['operator'],$noSpecial)) { $condAry[] = "  (c.ATTR_ID = ".$key."  and av.IDENTIFIER ".$val['operator']." '".$val['value']."')"; } elseif($val['operator'] == 'between') { $condAry[] = "  (c.ATTR_ID = ".$key."  and av.IDENTIFIER ".$val['operator']." '".$val['value']."' and '".$val['value_extra1']."')"; } elseif($val['operator'] == 'like') { } } $catentryAry = $exchangeAry = array(); $i = 0; foreach($condAry as $key=>$val) { $sql = "select DISTINCT CATENTRY_ID from catentryattr c left join attr a on a.attr_id = c.attr_id left join attrval av on av.attrval_id = c.attrval_id where ".iconv('utf-8','gb2312',$val); $query = $db2->query($sql); while($row = $db2->fetch_array($query)) { if($i == '0') { $exchangeAry[$row['CATENTRY_ID']] = 1; } else { if(isset($catentryAry[$row['CATENTRY_ID']]) && $catentryAry[$row['CATENTRY_ID']] == '1') { $exchangeAry[$row['CATENTRY_ID']] = 1; } } } $catentryAry = $exchangeAry; $exchangeAry = array(); $i++; } $cc = 1; $catentryStr = ''; foreach( $catentryAry as $key=>$val) { if($cc <= $perPageNum) { $catentryStr .= "'".$key."',"; $cc++; } else break; } $catentryStr = rtrim($catentryStr,','); $productInfoAry = $productTmpInfoAry = $paramDefineAry = array(); $i = 0; $sql = "select * from xcatentry where catentry_id in (".$catentryStr.")"; $query = $db2->query($sql); while($row = $db2->fetch_array($query)) { if($i >= $perPageNum) break; foreach($row as $key=>$val) { $row[$key] = iconv('gb2312','utf-8',$val); } $productTmpInfoAry[$row['CATENTRY_ID']] = $row; $i++; } $countNum = count($productTmpInfoAry); include template(); 