<?php
 define('IN_DAEM', true); include '../includes/init.php'; $processJsonData = '{"title":"newFlow_1","nodes":{"demo_node_1":{"name":"开始","left":26,"top":155,"type":"start round mix","width":26,"height":26,"alt":"true"},"demo_node_3":{"name":"入职申请","left":219,"top":110,"type":"task","width":104,"height":26,"marked":"true","alt":"true"},"demo_node_4":{"name":"人力审批","left":447,"top":58,"type":"task","width":104,"height":26,"alt":"true"},"demo_node_8":{"name":"工资判断","left":602,"top":59,"type":"node","width":104,"height":26,"alt":"true"},"demo_node_9":{"name":"经理终审","left":559,"top":141,"type":"task","width":104,"height":26,"alt":"true"},"1502242395947":{"name":"分支节点","left":77,"top":157,"type":"fork","width":102,"height":24,"alt":"true"},"1502242488302":{"name":"邮箱申请","left":216,"top":265,"type":"task","width":102,"height":24,"alt":"true"},"1502242506779":{"name":"系统开通","left":387,"top":261,"type":"task","width":102,"height":24,"alt":"true"},"1502242507694":{"name":"入职培训","left":574,"top":265,"type":"task","width":102,"height":24,"alt":"true"},"1502242616432":{"name":"完成","left":774,"top":207,"type":"end round","width":26,"height":26,"alt":"true"},"1502242623197":{"name":"人力部归档","left":706,"top":140,"type":"node","width":102,"height":24,"alt":"true"}},"lines":{"demo_line_5":{"type":"sl","from":"demo_node_3","to":"demo_node_4","name":"提交申请"},"demo_line_6":{"type":"sl","from":"demo_node_1","to":1502242395947,"name":"","alt":"true"},"demo_line_7":{"type":"tb","M":18.5,"from":"demo_node_4","to":"demo_node_3","name":"不通过"},"demo_line_10":{"type":"sl","from":"demo_node_4","to":"demo_node_8","name":"通过"},"demo_line_11":{"type":"tb","M":157,"from":"demo_node_9","to":"demo_node_4","name":"不接受"},"demo_line_12":{"type":"sl","from":"demo_node_8","to":"demo_node_9","name":"大于8000"},"1502242464524":{"type":"sl","from":1502242395947,"to":"demo_node_3","name":"","alt":"true"},"1502242491842":{"type":"sl","from":1502242395947,"to":1502242488302,"name":"","alt":"true"},"1502242527588":{"type":"sl","from":1502242488302,"to":1502242506779,"name":"","alt":"true"},"1502242528277":{"type":"sl","from":1502242506779,"to":1502242507694,"name":"","alt":"true"},"1502242529792":{"type":"tb","from":1502242507694,"to":1502242488302,"name":"不通过","alt":"true","M":240},"1502242629300":{"type":"sl","from":"demo_node_9","to":1502242623197,"name":"","alt":"true"},"1502242630642":{"type":"sl","from":"demo_node_8","to":1502242623197,"name":"","alt":"true"},"1502242637457":{"type":"sl","from":1502242507694,"to":1502242616432,"name":"通过","alt":"true"},"1502242638345":{"type":"sl","from":1502242623197,"to":1502242616432,"name":"","alt":"true"}},"areas":{"1497581247380":{"name":"审议会","left":451,"top":110,"color":"red","width":226,"height":108,"alt":"true"}},"initNum":41}'; $processAry = json_decode($processJsonData,true); $startNode = findNodeLineList($processAry["nodes"],array('type'=>'start round mix')); $startNodeKey = key($startNode); $lineA = findNodeLineList($processAry["lines"],array('from'=>$startNodeKey)); $lineA = reset($lineA); $nodeA = array($lineA["to"]=>$processAry["nodes"][$lineA["to"]]); $lines = findNodeLineList($processAry["lines"],array('from'=>key($nodeA))); print_r($processAry);die; function findNodeLineList($haystack,$conditionAry=array()) { $nodeArray = array(); foreach($haystack as $key=>$depth1) { foreach($depth1 as $kk=>$vv) { if(isset($conditionAry[$kk]) && $conditionAry[$kk]==$vv) { $nodeArray[$key] = $haystack[$key]; } } } return $nodeArray; } 